# Azure Network Monitoring Related

## Overall network monitoring

## Load balancer Resource health & inbound availability issues

* <https://learn.microsoft.com/en-us/azure/load-balancer/troubleshoot-rhc>

The Resource Health Check (RHC) is used to determine the health of the load balancer.
It analyzes the Data Path Availability metric over a 2-minute interval to determine whether
the load balancing endpoints, the frontend IP and frontend ports combinations with load balancing rules, are available.

RHC logic used to determine the health state of your load balancer.

* Available   - Healthy and available.
* Degraded    - Has platform or user initiated events impacting performance. Data path availability metric is 25% to 90%
* Unavailable - Not healthy. Data path availability metrics is < 25%
* Unknown     - health status haven't update or received data path availability info in last 10 mins. Transient, will reflect as soon as data is received.

### Data path availability

* Generated by a TCP ping every 25 secs on all frontend ports & inbound NAT rules
* The ping then is routed to any of the healthy backend instances
* If the service receives a response to the ping, it's a successful response and the sum of the metric is iterated once
* If there's no response, no iteration happens
* The count of this metric is 1/100 of the total TCP pings per sample period

We want to consider the average, which is the average of sum/count for the time period. The data shows the path availability metric aggregated by average thus gives us a percentage success rate for TCP pings on your frontend IP:port for each of your load-balancing and inbound NAT rules.

### Health probe status

* The health probe status metric is generated by a ping of the protocol defined in the health probe
* Sampled on a 1 minute basis
* This ping is sent to each instance in the backend pool and on the port defined in the health probe
* For HTTP and HTTPS probes, a successful ping requires an HTTP 200 OK response whereas with TCP probes any response is considered successful.
* Consecutive successes / failures of each probe determine the health of the backend instance and whether the assigned backend pool is able to receive traffic
* Similar to data path availability we use the average aggregation, which tells us the average successful/total pings during the sampling interval.
* This health probe status value indicates the backend health in isolation from your load balancer by probing your backend instances without sending traffic through the frontend.

<https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-custom-probe-overview>

### Degraded and unavailable diagnosis

## Network Watcher

* <https://www.youtube.com/watch?v=ZWij3TZdHvU&ab_channel=PaddyMaddy>

To access this tool, search for network watcher then select the relevant subscriptions.
It is designed to monitor and repair the network health of IaaS products (VMs, VNets, App Gateways, Load Balancers).
It is NOT for PaaS monitoring or web analytics.

It provides functions to:

* Monitor
* Diagnostics
* View Metrics
* Enable/Disable logs

VM extentions - network watcher agent for windows

Ensure that the network watcher is enabled for the region in the subscription

### Topology

### Connection Monitor

Test connections between resources within the network

### Network Performance Monitor (NPM)
